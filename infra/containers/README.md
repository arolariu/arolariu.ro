# Container Images for arolariu.ro

This directory contains Dockerfiles for building container images for all arolariu.ro sites.

## Available Dockerfiles

| Dockerfile | Site | Technology | Port |
|------------|------|------------|------|
| `Dockerfile.frontend` | arolariu.ro | Next.js 16 + React 19 | 3000 |
| `Dockerfile.backend` | api.arolariu.ro | .NET 10 ASP.NET Core | 8080 |
| `Dockerfile.cv` | cv.arolariu.ro | SvelteKit | 3000 |

## Build Context

**Important:** All Dockerfiles are designed to be built from the **repository root**, not from the `infra/containers` directory or individual site directories.

## Build Commands

### Frontend (arolariu.ro)

```bash
# From repository root
docker build -f infra/containers/Dockerfile.frontend -t arolariu-frontend .

# Run
docker run -p 3000:3000 arolariu-frontend
```

### Backend (api.arolariu.ro)

```bash
# From repository root
docker build -f infra/containers/Dockerfile.backend -t arolariu-backend \
  --build-arg API_NAME=api.arolariu.ro \
  --build-arg API_URL=https://api.arolariu.ro \
  --build-arg COMMIT_SHA=$(git rev-parse HEAD) \
  .

# Run
docker run -p 8080:8080 arolariu-backend
```

### CV Site (cv.arolariu.ro)

```bash
# From repository root
docker build -f infra/containers/Dockerfile.cv -t arolariu-cv .

# Run
docker run -p 3000:3000 arolariu-cv
```

## Environment Variables

### Frontend

The frontend requires a `.env` file with the following variables (generated by `npm run generate`):

- `SITE_ENV` - Environment (development/production)
- `SITE_URL` - Site URL
- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` - Clerk auth
- `CLERK_SECRET_KEY` - Clerk auth
- `RESEND_API_KEY` - Email service
- `API_URL` - Backend API URL
- `API_JWT` - API authentication token

### Backend

Build arguments (passed via `--build-arg`):

- `API_NAME` - API name
- `API_URL` - API URL
- `COMMIT_SHA` - Git commit SHA
- `INFRA` - Infrastructure type (local/azure)
- `AZURE_TENANT_ID` - Azure tenant ID
- `AZURE_SUBSCRIPTION_ID` - Azure subscription ID
- `AZURE_CLIENT_ID` - Azure client ID

## Multi-Architecture Builds

For building multi-architecture images (amd64/arm64):

```bash
docker buildx build --platform linux/amd64,linux/arm64 \
  -f infra/containers/Dockerfile.frontend \
  -t arolariu-frontend:latest \
  --push .
```

## Health Checks

- **Backend**: `GET /health` on port 8080
- **Frontend**: HTTP 200 on port 3000
- **CV**: HTTP 200 on port 3000

## Security

All containers:
- Run as non-root users (`nextjs`, `app`, `sveltekit`)
- Use Alpine-based images where possible for minimal attack surface
- Use multi-stage builds to exclude build tools from production images
