{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.36.1.42791",
      "templateHash": "16958176397159950098"
    },
    "description": "This bicep file is the main entry point for any zero-touch deployment.",
    "author": "Alexandru-Razvan Olariu <admin@arolariu.ro>"
  },
  "parameters": {
    "resourceGroupName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 90,
      "metadata": {
        "description": "The name of the resource group that will contain all the resources."
      }
    },
    "resourceGroupAuthor": {
      "type": "string",
      "minLength": 5,
      "maxLength": 100,
      "metadata": {
        "description": "The author of the resource group and deployment."
      }
    },
    "resourceGroupLocation": {
      "type": "string",
      "allowedValues": [
        "swedencentral",
        "norwayeast",
        "westeurope",
        "northeurope"
      ],
      "metadata": {
        "description": "The location of the resource group that will contain all the resources."
      }
    },
    "resourceDeploymentDate": {
      "type": "string",
      "defaultValue": "[utcNow()]",
      "metadata": {
        "description": "The date when the deployment is executed."
      }
    }
  },
  "resources": {
    "resourceGroup": {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2025-04-01",
      "name": "[parameters('resourceGroupName')]",
      "location": "[parameters('resourceGroupLocation')]",
      "tags": {
        "deploymentType": "Bicep",
        "deploymentAuthor": "[parameters('resourceGroupAuthor')]",
        "deploymentDate": "[parameters('resourceDeploymentDate')]"
      }
    },
    "mainDeployment": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "[format('mainDeployment-{0}', parameters('resourceDeploymentDate'))]",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "resourceDeploymentDate": {
            "value": "[parameters('resourceDeploymentDate')]"
          },
          "resourceLocation": {
            "value": "[parameters('resourceGroupLocation')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "languageVersion": "2.0",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.36.1.42791",
              "templateHash": "7568348932261934147"
            },
            "description": "This file acts a facade that will be called by the main bicep file. This file contains all module deployments (compute, storage, identity, etc.). This file is responsible for deploying all the modules.",
            "author": "Alexandru-Razvan Olariu"
          },
          "parameters": {
            "resourceDeploymentDate": {
              "type": "string",
              "defaultValue": "[utcNow()]",
              "metadata": {
                "description": "The date when the deployment is executed."
              }
            },
            "resourceLocation": {
              "type": "string",
              "allowedValues": [
                "swedencentral",
                "norwayeast",
                "westeurope",
                "northeurope"
              ],
              "metadata": {
                "description": "The location for the resources."
              }
            }
          },
          "variables": {
            "resourceConventionPrefix": "[substring(uniqueString(parameters('resourceDeploymentDate')), 0, 6)]"
          },
          "resources": {
            "identitiesDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('identitiesDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "754130318372479635"
                    }
                  },
                  "definitions": {
                    "identity": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "displayName": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        }
                      },
                      "metadata": {
                        "type": "identity",
                        "name": "identity",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "../types/identity.type.bicep"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the resources."
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    }
                  },
                  "variables": {
                    "managedIdentitiesNamePrefix": "[format('{0}-uami', parameters('resourceConventionPrefix'))]"
                  },
                  "resources": {
                    "managedIdentities": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('managedIdentitiesDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "userAssignedManagedIdentityNamePrefix": {
                            "value": "[variables('managedIdentitiesNamePrefix')]"
                          },
                          "userAssignedManagedIdentityLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "userAssignedManagedIdentityDeploymentDate": {
                            "value": "[parameters('resourceDeploymentDate')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "9246392451260014152"
                            },
                            "description": "This template will create three user assigned managed identities: Front-End, Back-End, Infrastructure",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "definitions": {
                            "identity": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "displayName": {
                                  "type": "string"
                                },
                                "id": {
                                  "type": "string"
                                }
                              },
                              "metadata": {
                                "type": "identity",
                                "name": "identity",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "../types/identity.type.bicep"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "userAssignedManagedIdentityNamePrefix": {
                              "type": "string",
                              "metadata": {
                                "description": "The prefix for the user assigned managed identities"
                              }
                            },
                            "userAssignedManagedIdentityLocation": {
                              "type": "string",
                              "allowedValues": [
                                "swedencentral",
                                "norwayeast",
                                "westeurope",
                                "northeurope"
                              ],
                              "metadata": {
                                "description": "The location of the user assigned managed identities"
                              }
                            },
                            "userAssignedManagedIdentityDeploymentDate": {
                              "type": "string",
                              "metadata": {
                                "description": "The date when the deployment is executed."
                              }
                            }
                          },
                          "variables": {
                            "commonTags": {
                              "environment": "PRODUCTION",
                              "deploymentType": "Bicep",
                              "deploymentDate": "[parameters('userAssignedManagedIdentityDeploymentDate')]",
                              "deploymentAuthor": "Alexandru-Razvan Olariu",
                              "module": "identity",
                              "costCenter": "infrastructure",
                              "owner": "Alexandru-Razvan Olariu",
                              "project": "arolariu.ro",
                              "version": "2.0.0",
                              "criticality": "high",
                              "dataClassification": "internal",
                              "backup": "required",
                              "resourceType": "Managed Identity"
                            },
                            "identities": [
                              {
                                "name": "[format('{0}-frontend', parameters('userAssignedManagedIdentityNamePrefix'))]",
                                "location": "[parameters('userAssignedManagedIdentityLocation')]",
                                "displayName": "Frontend Identity"
                              },
                              {
                                "name": "[format('{0}-backend', parameters('userAssignedManagedIdentityNamePrefix'))]",
                                "location": "[parameters('userAssignedManagedIdentityLocation')]",
                                "displayName": "Backend Identity"
                              },
                              {
                                "name": "[format('{0}-infrastructure', parameters('userAssignedManagedIdentityNamePrefix'))]",
                                "location": "[parameters('userAssignedManagedIdentityLocation')]",
                                "displayName": "Infrastructure Identity"
                              }
                            ]
                          },
                          "resources": {
                            "userAssignedManagedIdentities": {
                              "copy": {
                                "name": "userAssignedManagedIdentities",
                                "count": "[length(variables('identities'))]"
                              },
                              "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                              "apiVersion": "2025-01-31-preview",
                              "name": "[variables('identities')[copyIndex()].name]",
                              "location": "[variables('identities')[copyIndex()].location]",
                              "tags": "[union(variables('commonTags'), createObject('displayName', variables('identities')[copyIndex()].displayName, 'identityType', variables('identities')[copyIndex()].displayName))]"
                            }
                          },
                          "outputs": {
                            "userAssignedManagedIdentities": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/identity"
                              },
                              "copy": {
                                "count": "[length(range(0, length(variables('identities'))))]",
                                "input": {
                                  "name": "[variables('identities')[range(0, length(variables('identities')))[copyIndex()]].name]",
                                  "displayName": "[variables('identities')[range(0, length(variables('identities')))[copyIndex()]].displayName]",
                                  "id": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('identities')[range(0, length(variables('identities')))[copyIndex()]].name)]"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "federatedIdentities": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('federatedIdentitiesDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "infrastructureManagedIdentity": {
                            "value": "[reference('managedIdentities').outputs.userAssignedManagedIdentities.value[2]]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "15579661268944913918"
                            },
                            "description": "This template will create a federated managed identity for the Azure resources.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "definitions": {
                            "identity": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "displayName": {
                                  "type": "string"
                                },
                                "id": {
                                  "type": "string"
                                }
                              },
                              "metadata": {
                                "type": "identity",
                                "name": "identity",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "../types/identity.type.bicep"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "infrastructureManagedIdentity": {
                              "$ref": "#/definitions/identity"
                            }
                          },
                          "resources": {
                            "managedIdentity": {
                              "existing": true,
                              "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                              "apiVersion": "2025-01-31-preview",
                              "name": "[parameters('infrastructureManagedIdentity').name]"
                            },
                            "productionFederatedIdentityForGitHub": {
                              "type": "Microsoft.ManagedIdentity/userAssignedIdentities/federatedIdentityCredentials",
                              "apiVersion": "2025-01-31-preview",
                              "name": "[format('{0}/{1}', parameters('infrastructureManagedIdentity').name, 'FederatedGithubCredentialForProduction')]",
                              "properties": {
                                "issuer": "https://token.actions.githubusercontent.com",
                                "subject": "repo:arolariu/arolariu.ro:environment:production",
                                "audiences": [
                                  "api://AzureADTokenExchange"
                                ]
                              }
                            },
                            "developmentFederatedIdentityForGitHub": {
                              "type": "Microsoft.ManagedIdentity/userAssignedIdentities/federatedIdentityCredentials",
                              "apiVersion": "2025-01-31-preview",
                              "name": "[format('{0}/{1}', parameters('infrastructureManagedIdentity').name, 'FederatedGithubCredentialForDevelopment')]",
                              "properties": {
                                "issuer": "https://token.actions.githubusercontent.com",
                                "subject": "repo:arolariu/arolariu.ro:environment:development",
                                "audiences": [
                                  "api://AzureADTokenExchange"
                                ]
                              }
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "managedIdentities"
                      ]
                    },
                    "securityGroups": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('securityGroupsDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "identities": {
                            "value": "[reference('managedIdentities').outputs.userAssignedManagedIdentities.value]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.1-experimental",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "14577208301005766630"
                            },
                            "description": "This template will create security groups for specific access to resources.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "definitions": {
                            "identity": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "displayName": {
                                  "type": "string"
                                },
                                "id": {
                                  "type": "string"
                                }
                              },
                              "metadata": {
                                "type": "identity",
                                "name": "identity",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "../types/identity.type.bicep"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "identities": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/identity"
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "identitiesArray",
                                "count": "[length(parameters('identities'))]",
                                "input": "[parameters('identities')[copyIndex('identitiesArray')].id]"
                              }
                            ]
                          },
                          "imports": {
                            "MicrosoftGraph": {
                              "provider": "MicrosoftGraph",
                              "version": "0.1.9-preview"
                            }
                          },
                          "resources": {
                            "securityGroupForUsers": {
                              "import": "MicrosoftGraph",
                              "type": "Microsoft.Graph/groups@v1.0",
                              "properties": {
                                "displayName": "arolariu-JIT-Users",
                                "mailEnabled": true,
                                "mailNickname": "arolariu-JIT-Users",
                                "securityEnabled": true,
                                "uniqueName": "arolariu-JIT-Users",
                                "description": "Security group for Just-In-Time access to resources, for users."
                              }
                            },
                            "securityGroupForApps": {
                              "import": "MicrosoftGraph",
                              "type": "Microsoft.Graph/groups@v1.0",
                              "properties": {
                                "displayName": "arolariu-JIT-Apps",
                                "mailEnabled": false,
                                "mailNickname": "arolariu-JIT-Apps",
                                "securityEnabled": true,
                                "uniqueName": "arolariu-JIT-Apps",
                                "description": "Security group for Just-In-Time access to resources, for User Assigned Managed Identities (UAMIs).",
                                "members": "[variables('identitiesArray')]"
                              }
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "managedIdentities"
                      ]
                    }
                  },
                  "outputs": {
                    "managedIdentitiesList": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/identity"
                      },
                      "value": "[reference('managedIdentities').outputs.userAssignedManagedIdentities.value]"
                    }
                  }
                }
              }
            },
            "networkDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('networkDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "16416079630892410588"
                    }
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the resources."
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    }
                  },
                  "variables": {
                    "azureFrontDoorName": "[format('{0}-afd', parameters('resourceConventionPrefix'))]"
                  },
                  "resources": {
                    "azureFrontDoorDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('azureFrontDoorDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "frontDoorName": {
                            "value": "[variables('azureFrontDoorName')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "2619750685415825681"
                            },
                            "description": "This template will deploy an Azure Front Door resource.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "frontDoorName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Front Door resource."
                              }
                            }
                          },
                          "variables": {
                            "frontDoorCdnOrigins": [
                              {
                                "name": "apex-domain",
                                "hostName": "arolariu.ro",
                                "httpPort": 80,
                                "httpsPort": 443,
                                "originHostHeader": "arolariu.ro",
                                "priority": 1,
                                "weight": 1000,
                                "enabledState": "Enabled",
                                "enforceCertificateNameCheck": false
                              },
                              {
                                "name": "www-subdomain",
                                "hostName": "www.arolariu.ro",
                                "httpPort": 80,
                                "httpsPort": 443,
                                "originHostHeader": "www.arolariu.ro",
                                "priority": 2,
                                "weight": 1000,
                                "enabledState": "Enabled",
                                "enforceCertificateNameCheck": false
                              }
                            ]
                          },
                          "resources": {
                            "frontDoor": {
                              "type": "Microsoft.Network/frontDoors",
                              "apiVersion": "2021-06-01",
                              "name": "[parameters('frontDoorName')]",
                              "location": "Global",
                              "properties": {
                                "friendlyName": "[parameters('frontDoorName')]",
                                "enabledState": "Enabled"
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            },
                            "frontDoorProfile": {
                              "type": "Microsoft.Cdn/profiles",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[parameters('frontDoorName')]",
                              "location": "Global",
                              "sku": {
                                "name": "Standard_AzureFrontDoor"
                              },
                              "properties": {
                                "originResponseTimeoutSeconds": 16
                              },
                              "dependsOn": [
                                "frontDoor"
                              ]
                            },
                            "frontDoorProfileRuleSet": {
                              "type": "Microsoft.Cdn/profiles/ruleSets",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('frontDoorName'), 'CdnRuleSet')]",
                              "dependsOn": [
                                "frontDoorProfile"
                              ]
                            },
                            "frontDoorProfileRuleSetRules": {
                              "type": "Microsoft.Cdn/profiles/ruleSets/rules",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}/{2}', parameters('frontDoorName'), 'CdnRuleSet', 'CdnRules')]",
                              "properties": {
                                "order": 3,
                                "conditions": [
                                  {
                                    "name": "RequestHeader",
                                    "parameters": {
                                      "typeName": "DeliveryRuleRequestHeaderConditionParameters",
                                      "operator": "Equal",
                                      "selector": "Origin",
                                      "negateCondition": false,
                                      "matchValues": [
                                        "https://arolariu.ro",
                                        "https://www.arolariu.ro"
                                      ],
                                      "transforms": []
                                    }
                                  }
                                ],
                                "actions": [
                                  {
                                    "name": "ModifyResponseHeader",
                                    "parameters": {
                                      "typeName": "DeliveryRuleHeaderActionParameters",
                                      "headerAction": "Overwrite",
                                      "headerName": "Access-Control-Allow-Origin",
                                      "value": "https://arolariu.ro"
                                    }
                                  },
                                  {
                                    "name": "ModifyResponseHeader",
                                    "parameters": {
                                      "typeName": "DeliveryRuleHeaderActionParameters",
                                      "headerAction": "Append",
                                      "headerName": "X-Woff2-Access",
                                      "value": "ALLOW"
                                    }
                                  }
                                ],
                                "matchProcessingBehavior": "Continue"
                              },
                              "dependsOn": [
                                "frontDoorProfileRuleSet"
                              ]
                            },
                            "frontDoorProductionEndpoint": {
                              "type": "Microsoft.Cdn/profiles/afdEndpoints",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('frontDoorName'), 'production')]",
                              "location": "Global",
                              "dependsOn": [
                                "frontDoorProfile"
                              ]
                            },
                            "frontDoorCdnEndpoint": {
                              "type": "Microsoft.Cdn/profiles/afdEndpoints",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('frontDoorName'), 'cdn')]",
                              "location": "Global",
                              "dependsOn": [
                                "frontDoorProfile"
                              ]
                            },
                            "frontDoorProductionOriginGroups": {
                              "type": "Microsoft.Cdn/profiles/originGroups",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('frontDoorName'), 'production')]",
                              "properties": {
                                "sessionAffinityState": "Enabled",
                                "loadBalancingSettings": {
                                  "sampleSize": 4,
                                  "successfulSamplesRequired": 3,
                                  "additionalLatencyInMilliseconds": 50
                                }
                              },
                              "dependsOn": [
                                "frontDoorProfile"
                              ]
                            },
                            "frontDoorCdnOriginGroups": {
                              "type": "Microsoft.Cdn/profiles/originGroups",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('frontDoorName'), 'cdn')]",
                              "properties": {
                                "sessionAffinityState": "Disabled",
                                "loadBalancingSettings": {
                                  "sampleSize": 4,
                                  "successfulSamplesRequired": 3,
                                  "additionalLatencyInMilliseconds": 50
                                }
                              },
                              "dependsOn": [
                                "frontDoorProfile"
                              ]
                            },
                            "frontDoorCdnOriginGroupOrigins": {
                              "copy": {
                                "name": "frontDoorCdnOriginGroupOrigins",
                                "count": "[length(variables('frontDoorCdnOrigins'))]"
                              },
                              "type": "Microsoft.Cdn/profiles/originGroups/origins",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}/{2}', parameters('frontDoorName'), 'cdn', variables('frontDoorCdnOrigins')[copyIndex()].name)]",
                              "properties": {
                                "hostName": "[variables('frontDoorCdnOrigins')[copyIndex()].hostName]",
                                "httpPort": "[variables('frontDoorCdnOrigins')[copyIndex()].httpPort]",
                                "httpsPort": "[variables('frontDoorCdnOrigins')[copyIndex()].httpsPort]",
                                "originHostHeader": "[variables('frontDoorCdnOrigins')[copyIndex()].originHostHeader]",
                                "priority": "[variables('frontDoorCdnOrigins')[copyIndex()].priority]",
                                "weight": "[variables('frontDoorCdnOrigins')[copyIndex()].weight]",
                                "enabledState": "[variables('frontDoorCdnOrigins')[copyIndex()].enabledState]",
                                "enforceCertificateNameCheck": "[variables('frontDoorCdnOrigins')[copyIndex()].enforceCertificateNameCheck]"
                              },
                              "dependsOn": [
                                "frontDoorCdnOriginGroups"
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "configurationDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('configurationDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  },
                  "identities": {
                    "value": "[reference('identitiesDeployment').outputs.managedIdentitiesList.value]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "4966533246889331707"
                    }
                  },
                  "definitions": {
                    "identity": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "displayName": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        }
                      },
                      "metadata": {
                        "type": "identity",
                        "name": "identity",
                        "__bicep_imported_from!": {
                          "sourceTemplate": "../types/identity.type.bicep"
                        }
                      }
                    }
                  },
                  "parameters": {
                    "identities": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/identity"
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the App Configuration resource."
                      }
                    },
                    "resourceDeploymentDate": {
                      "type": "string",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    }
                  },
                  "variables": {
                    "keyVaultName": "[format('{0}-kv', parameters('resourceConventionPrefix'))]",
                    "appConfigurationName": "[format('{0}-appconfig', parameters('resourceConventionPrefix'))]"
                  },
                  "resources": {
                    "keyVaultDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('keyVaultDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "keyVaultName": {
                            "value": "[variables('keyVaultName')]"
                          },
                          "identities": {
                            "value": "[parameters('identities')]"
                          },
                          "resourceDeploymentDate": {
                            "value": "[parameters('resourceDeploymentDate')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "8735998855904700792"
                            },
                            "description": "This template will create the necessary Azure Key Vault resources for arolariu.ro",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "definitions": {
                            "identity": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "displayName": {
                                  "type": "string"
                                },
                                "id": {
                                  "type": "string"
                                }
                              },
                              "metadata": {
                                "type": "identity",
                                "name": "identity",
                                "__bicep_imported_from!": {
                                  "sourceTemplate": "../types/identity.type.bicep"
                                }
                              }
                            }
                          },
                          "parameters": {
                            "identities": {
                              "type": "array",
                              "items": {
                                "$ref": "#/definitions/identity"
                              }
                            },
                            "keyVaultName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the Azure Key Vault resource."
                              }
                            },
                            "keyVaultLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "The location for the Azure Key Vault resource."
                              }
                            },
                            "resourceDeploymentDate": {
                              "type": "string",
                              "defaultValue": "[utcNow()]",
                              "metadata": {
                                "description": "The date when the deployment is executed."
                              }
                            }
                          },
                          "variables": {
                            "copy": [
                              {
                                "name": "accessPolicies",
                                "count": "[length(parameters('identities'))]",
                                "input": {
                                  "objectId": "[parameters('identities')[copyIndex('accessPolicies')].id]",
                                  "tenantId": "[subscription().tenantId]",
                                  "permissions": {
                                    "certificates": [
                                      "GET",
                                      "LIST",
                                      "UPDATE",
                                      "CREATE",
                                      "IMPORT",
                                      "DELETE",
                                      "RECOVER",
                                      "BACKUP",
                                      "RESTORE",
                                      "MANAGECONTACTS",
                                      "MANAGEISSUERS",
                                      "GETISSUERS",
                                      "LISTISSUERS",
                                      "SETISSUERS",
                                      "DELETEISSUERS"
                                    ],
                                    "keys": [
                                      "GET",
                                      "LIST",
                                      "UPDATE",
                                      "CREATE",
                                      "IMPORT",
                                      "DELETE",
                                      "RECOVER",
                                      "BACKUP",
                                      "RESTORE",
                                      "ROTATE"
                                    ],
                                    "secrets": [
                                      "GET",
                                      "LIST",
                                      "SET",
                                      "DELETE",
                                      "RECOVER",
                                      "BACKUP",
                                      "RESTORE"
                                    ]
                                  }
                                }
                              }
                            ],
                            "commonTags": {
                              "environment": "PRODUCTION",
                              "deploymentType": "Bicep",
                              "deploymentDate": "[parameters('resourceDeploymentDate')]",
                              "deploymentAuthor": "Alexandru-Razvan Olariu",
                              "module": "configuration-keyvault",
                              "costCenter": "infrastructure",
                              "owner": "Alexandru-Razvan Olariu",
                              "project": "arolariu.ro",
                              "version": "2.0.0",
                              "criticality": "high",
                              "dataClassification": "confidential",
                              "backup": "required",
                              "resourceType": "Key Vault"
                            },
                            "keyVaultSecretNames": [
                              "ConfigurationStore",
                              "jwt-secret",
                              "AzureOptions-StorageAccountConnectionString",
                              "AzureOptions-SqlConnectionString",
                              "AzureOptions-NoSqlConnectionString",
                              "AzureOptions-CognitiveServicesKey",
                              "AzureOptions-OpenAIKey",
                              "sql-admin-username",
                              "sql-admin-password"
                            ]
                          },
                          "resources": {
                            "keyVault": {
                              "type": "Microsoft.KeyVault/vaults",
                              "apiVersion": "2024-04-01-preview",
                              "name": "[parameters('keyVaultName')]",
                              "location": "[parameters('keyVaultLocation')]",
                              "properties": {
                                "accessPolicies": "[variables('accessPolicies')]",
                                "createMode": "default",
                                "enabledForDeployment": false,
                                "enabledForDiskEncryption": false,
                                "enabledForTemplateDeployment": true,
                                "enablePurgeProtection": true,
                                "enableRbacAuthorization": false,
                                "enableSoftDelete": true,
                                "networkAcls": {},
                                "provisioningState": "Succeeded",
                                "publicNetworkAccess": "enabled",
                                "sku": {
                                  "family": "A",
                                  "name": "standard"
                                },
                                "softDeleteRetentionInDays": 90,
                                "tenantId": "[subscription().tenantId]",
                                "vaultUri": "[format('https://{0}{1}', parameters('keyVaultName'), environment().suffixes.keyvaultDns)]"
                              },
                              "tags": "[variables('commonTags')]"
                            },
                            "keyVaultItems": {
                              "copy": {
                                "name": "keyVaultItems",
                                "count": "[length(variables('keyVaultSecretNames'))]"
                              },
                              "type": "Microsoft.KeyVault/vaults/secrets",
                              "apiVersion": "2024-04-01-preview",
                              "name": "[format('{0}/{1}', parameters('keyVaultName'), variables('keyVaultSecretNames')[copyIndex()])]",
                              "properties": {
                                "attributes": {
                                  "enabled": true
                                }
                              },
                              "dependsOn": [
                                "keyVault"
                              ]
                            }
                          },
                          "outputs": {
                            "mainKeyVaultUri": {
                              "type": "string",
                              "value": "[reference('keyVault').vaultUri]"
                            },
                            "mainKeyVaultResourceId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName'))]"
                            },
                            "mainKeyVaultName": {
                              "type": "string",
                              "value": "[parameters('keyVaultName')]"
                            }
                          }
                        }
                      }
                    },
                    "appConfigurationDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('appConfigurationDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "appConfigurationName": {
                            "value": "[variables('appConfigurationName')]"
                          },
                          "appConfigurationLocation": {
                            "value": "[parameters('resourceLocation')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "8594051085787515651"
                            },
                            "description": "This template will deploy an Azure App Configuration resource running on the free SKU.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "appConfigurationName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the App Configuration resource."
                              }
                            },
                            "appConfigurationLocation": {
                              "type": "string",
                              "metadata": {
                                "description": "The location for the App Configuration resource."
                              }
                            }
                          },
                          "resources": {
                            "appConfiguration": {
                              "type": "Microsoft.AppConfiguration/configurationStores",
                              "apiVersion": "2024-06-15-preview",
                              "name": "[parameters('appConfigurationName')]",
                              "location": "[parameters('appConfigurationLocation')]",
                              "sku": {
                                "name": "free"
                              },
                              "properties": {
                                "createMode": "Default",
                                "disableLocalAuth": true,
                                "enablePurgeProtection": false,
                                "softDeleteRetentionInDays": 0,
                                "publicNetworkAccess": "Enabled",
                                "dataPlaneProxy": {
                                  "authenticationMode": "Pass-through",
                                  "privateLinkDelegation": "Disabled"
                                }
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          },
                          "outputs": {
                            "appConfigurationResourceId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.AppConfiguration/configurationStores', parameters('appConfigurationName'))]"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "dependsOn": [
                "identitiesDeployment"
              ]
            },
            "observabilityDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('observabilityDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "15013558334839937154"
                    }
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    }
                  },
                  "resources": {
                    "logAnalyticsWorkspaceDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('logAnalyticsWorkspaceDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "logAnalyticsWorkspaceName": {
                            "value": "[format('{0}-workspace', parameters('resourceConventionPrefix'))]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "2490397949733724664"
                            },
                            "description": "This template will deploy a log analytics workspace that is used for Open Telemetry (OTel) data collection.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "logAnalyticsWorkspaceLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "logAnalyticsWorkspaceName": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "logAnalyticsWorkspace": {
                              "type": "Microsoft.OperationalInsights/workspaces",
                              "apiVersion": "2023-09-01",
                              "name": "[parameters('logAnalyticsWorkspaceName')]",
                              "location": "[parameters('logAnalyticsWorkspaceLocation')]",
                              "properties": {
                                "sku": {
                                  "name": "PerGB2018"
                                },
                                "retentionInDays": 90,
                                "publicNetworkAccessForIngestion": "Enabled",
                                "publicNetworkAccessForQuery": "Enabled",
                                "workspaceCapping": {
                                  "dailyQuotaGb": 3
                                },
                                "features": {
                                  "enableLogAccessUsingOnlyResourcePermissions": true
                                }
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          },
                          "outputs": {
                            "logAnalyticsWorkspaceId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsWorkspaceName'))]"
                            }
                          }
                        }
                      }
                    },
                    "applicationInsightsDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('applicationInsightsDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "applicationInsightsName": {
                            "value": "[format('{0}-insights', parameters('resourceConventionPrefix'))]"
                          },
                          "applicationInsightsWorkspaceId": {
                            "value": "[reference('logAnalyticsWorkspaceDeployment').outputs.logAnalyticsWorkspaceId.value]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "8232838617594245775"
                            },
                            "description": "This template will deploy an application insights resource that is connected to the api.arolariu.ro platform (back-end) and the arolariu.ro platform (front-end).",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "applicationInsightsLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "applicationInsightsWorkspaceId": {
                              "type": "string"
                            },
                            "applicationInsightsName": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "applicationInsights": {
                              "type": "Microsoft.Insights/components",
                              "apiVersion": "2020-02-02",
                              "name": "[parameters('applicationInsightsName')]",
                              "location": "[parameters('applicationInsightsLocation')]",
                              "kind": "web",
                              "properties": {
                                "Application_Type": "web",
                                "Flow_Type": "Bluefield",
                                "Request_Source": "rest",
                                "RetentionInDays": 90,
                                "WorkspaceResourceId": "[parameters('applicationInsightsWorkspaceId')]",
                                "IngestionMode": "LogAnalytics",
                                "publicNetworkAccessForIngestion": "Enabled",
                                "publicNetworkAccessForQuery": "Enabled",
                                "SamplingPercentage": 30
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "logAnalyticsWorkspaceDeployment"
                      ]
                    },
                    "managedGrafanaDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('managedGrafanaDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "managedGrafanaName": {
                            "value": "[format('{0}-grafana', parameters('resourceConventionPrefix'))]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "1068091617314220526"
                            },
                            "description": "This template will deploy an Azure Managed Grafana instance.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "managedGrafanaLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "managedGrafanaName": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "managedGrafanaInstance": {
                              "type": "Microsoft.Dashboard/grafana",
                              "apiVersion": "2023-09-01",
                              "name": "[parameters('managedGrafanaName')]",
                              "location": "[parameters('managedGrafanaLocation')]",
                              "sku": {
                                "name": "Essential"
                              },
                              "properties": {
                                "grafanaMajorVersion": "10",
                                "zoneRedundancy": "Disabled",
                                "publicNetworkAccess": "Enabled",
                                "apiKey": "Enabled",
                                "autoGeneratedDomainNameLabelScope": "TenantReuse",
                                "deterministicOutboundIP": "Disabled",
                                "grafanaConfigurations": {
                                  "smtp": {
                                    "enabled": false
                                  }
                                },
                                "grafanaIntegrations": {
                                  "azureMonitorWorkspaceIntegrations": []
                                }
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          },
                          "outputs": {
                            "managedGrafanaInstanceName": {
                              "type": "string",
                              "value": "[parameters('managedGrafanaName')]"
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "applicationInsightsDeployment",
                        "logAnalyticsWorkspaceDeployment"
                      ]
                    }
                  }
                }
              },
              "dependsOn": [
                "configurationDeployment",
                "identitiesDeployment"
              ]
            },
            "storageDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('storageDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "9770320281321742383"
                    },
                    "description": "Storage module deployment file that provisions storage accounts, container registry, and databases with enterprise security standards.",
                    "author": "Alexandru-Razvan Olariu"
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 20,
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the resources."
                      }
                    }
                  },
                  "variables": {
                    "commonTags": {
                      "environment": "PRODUCTION",
                      "deploymentType": "Bicep",
                      "deploymentDate": "[parameters('resourceDeploymentDate')]",
                      "module": "storage",
                      "costCenter": "infrastructure",
                      "owner": "Alexandru-Razvan Olariu",
                      "project": "arolariu.ro"
                    },
                    "storageAccountName": "[format('{0}sa', replace(parameters('resourceConventionPrefix'), '-', ''))]",
                    "containerRegistryName": "[format('{0}-acr', parameters('resourceConventionPrefix'))]",
                    "sqlServerName": "[format('{0}-sqlserver', parameters('resourceConventionPrefix'))]",
                    "noSqlServerName": "[format('{0}-nosqlserver', parameters('resourceConventionPrefix'))]"
                  },
                  "resources": {
                    "storageAccountDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('storageAccountDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "storageAccountName": {
                            "value": "[variables('storageAccountName')]"
                          },
                          "location": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "tags": {
                            "value": "[variables('commonTags')]"
                          },
                          "managedIdentityId": {
                            "value": ""
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "15154740140793253311"
                            },
                            "description": "This template creates a secure storage account with enterprise-grade security standards.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "location": {
                              "type": "string",
                              "metadata": {
                                "description": "The location for the storage account resource."
                              }
                            },
                            "storageAccountName": {
                              "type": "string",
                              "minLength": 3,
                              "maxLength": 24,
                              "metadata": {
                                "description": "The storage account name."
                              }
                            },
                            "tags": {
                              "type": "object",
                              "defaultValue": {},
                              "metadata": {
                                "description": "Resource tags for governance and cost tracking."
                              }
                            },
                            "managedIdentityId": {
                              "type": "string",
                              "defaultValue": "",
                              "metadata": {
                                "description": "Managed identity resource ID for secure access."
                              }
                            }
                          },
                          "variables": {
                            "enhancedTags": "[union(parameters('tags'), createObject('resourceType', 'Storage Account'))]"
                          },
                          "resources": {
                            "storageAccount::blobServices": {
                              "type": "Microsoft.Storage/storageAccounts/blobServices",
                              "apiVersion": "2023-05-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {
                                "changeFeed": {
                                  "enabled": true,
                                  "retentionInDays": 90
                                },
                                "restorePolicy": {
                                  "enabled": true,
                                  "days": 30
                                },
                                "containerDeleteRetentionPolicy": {
                                  "enabled": true,
                                  "days": 7
                                },
                                "cors": {
                                  "corsRules": [
                                    {
                                      "allowedOrigins": [
                                        "https://arolariu.ro",
                                        "https://dev.arolariu.ro"
                                      ],
                                      "allowedMethods": [
                                        "GET",
                                        "POST",
                                        "PUT",
                                        "DELETE",
                                        "HEAD",
                                        "OPTIONS"
                                      ],
                                      "allowedHeaders": [
                                        "*"
                                      ],
                                      "exposedHeaders": [
                                        "*"
                                      ],
                                      "maxAgeInSeconds": 3600
                                    },
                                    {
                                      "allowedOrigins": [
                                        "http://localhost:3000",
                                        "http://localhost:3001"
                                      ],
                                      "allowedMethods": [
                                        "GET",
                                        "POST",
                                        "PUT",
                                        "DELETE"
                                      ],
                                      "allowedHeaders": [
                                        "*"
                                      ],
                                      "exposedHeaders": [
                                        "*"
                                      ],
                                      "maxAgeInSeconds": 1800
                                    }
                                  ]
                                },
                                "deleteRetentionPolicy": {
                                  "enabled": true,
                                  "days": 7,
                                  "allowPermanentDelete": false
                                },
                                "isVersioningEnabled": true,
                                "lastAccessTimeTrackingPolicy": {
                                  "enable": true,
                                  "name": "AccessTimeTracking",
                                  "trackingGranularityInDays": 1,
                                  "blobType": [
                                    "blockBlob"
                                  ]
                                }
                              },
                              "dependsOn": [
                                "storageAccount"
                              ]
                            },
                            "storageAccount::fileServices": {
                              "type": "Microsoft.Storage/storageAccounts/fileServices",
                              "apiVersion": "2023-05-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {
                                "shareDeleteRetentionPolicy": {
                                  "enabled": true,
                                  "days": 7,
                                  "allowPermanentDelete": false
                                },
                                "protocolSettings": {
                                  "smb": {
                                    "versions": "SMB3.0;SMB3.1.1",
                                    "authenticationMethods": "Kerberos",
                                    "kerberosTicketEncryption": "AES-256",
                                    "channelEncryption": "AES-128-CCM;AES-128-GCM;AES-256-GCM"
                                  }
                                }
                              },
                              "dependsOn": [
                                "storageAccount"
                              ]
                            },
                            "storageAccount::queueServices": {
                              "type": "Microsoft.Storage/storageAccounts/queueServices",
                              "apiVersion": "2023-05-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {},
                              "dependsOn": [
                                "storageAccount"
                              ]
                            },
                            "storageAccount::tableServices": {
                              "type": "Microsoft.Storage/storageAccounts/tableServices",
                              "apiVersion": "2023-05-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {},
                              "dependsOn": [
                                "storageAccount"
                              ]
                            },
                            "storageAccount": {
                              "type": "Microsoft.Storage/storageAccounts",
                              "apiVersion": "2023-05-01",
                              "name": "[parameters('storageAccountName')]",
                              "location": "[parameters('location')]",
                              "sku": {
                                "name": "Standard_LRS"
                              },
                              "kind": "StorageV2",
                              "identity": "[if(not(empty(parameters('managedIdentityId'))), createObject('type', 'UserAssigned', 'userAssignedIdentities', createObject(format('{0}', parameters('managedIdentityId')), createObject())), null())]",
                              "properties": {
                                "dnsEndpointType": "Standard",
                                "defaultToOAuthAuthentication": true,
                                "publicNetworkAccess": "Enabled",
                                "allowCrossTenantReplication": false,
                                "minimumTlsVersion": "TLS1_2",
                                "allowBlobPublicAccess": true,
                                "allowSharedKeyAccess": true,
                                "networkAcls": {
                                  "bypass": "AzureServices, Logging, Metrics",
                                  "defaultAction": "Allow"
                                },
                                "supportsHttpsTrafficOnly": true,
                                "encryption": {
                                  "keySource": "Microsoft.Storage",
                                  "requireInfrastructureEncryption": true,
                                  "services": {
                                    "blob": {
                                      "enabled": true,
                                      "keyType": "Account"
                                    },
                                    "file": {
                                      "enabled": true,
                                      "keyType": "Account"
                                    },
                                    "queue": {
                                      "enabled": true,
                                      "keyType": "Account"
                                    },
                                    "table": {
                                      "enabled": true,
                                      "keyType": "Account"
                                    }
                                  }
                                },
                                "accessTier": "Hot"
                              },
                              "tags": "[variables('enhancedTags')]"
                            },
                            "lifecyclePolicy": {
                              "type": "Microsoft.Storage/storageAccounts/managementPolicies",
                              "apiVersion": "2023-05-01",
                              "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
                              "properties": {
                                "policy": {
                                  "rules": [
                                    {
                                      "enabled": true,
                                      "name": "MoveToIA",
                                      "type": "Lifecycle",
                                      "definition": {
                                        "filters": {
                                          "blobTypes": [
                                            "blockBlob"
                                          ]
                                        },
                                        "actions": {
                                          "baseBlob": {
                                            "tierToCool": {
                                              "daysAfterModificationGreaterThan": 30
                                            },
                                            "tierToArchive": {
                                              "daysAfterModificationGreaterThan": 90
                                            },
                                            "delete": {
                                              "daysAfterModificationGreaterThan": 365
                                            }
                                          },
                                          "snapshot": {
                                            "delete": {
                                              "daysAfterCreationGreaterThan": 90
                                            }
                                          },
                                          "version": {
                                            "delete": {
                                              "daysAfterCreationGreaterThan": 365
                                            }
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              "dependsOn": [
                                "storageAccount"
                              ]
                            }
                          },
                          "outputs": {
                            "storageAccountName": {
                              "type": "string",
                              "value": "[parameters('storageAccountName')]"
                            },
                            "storageAccountId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                            },
                            "storageAccountBlobEndpoint": {
                              "type": "string",
                              "value": "[reference('storageAccount').primaryEndpoints.blob]"
                            },
                            "storageAccountFileEndpoint": {
                              "type": "string",
                              "value": "[reference('storageAccount').primaryEndpoints.file]"
                            },
                            "storageAccountQueueEndpoint": {
                              "type": "string",
                              "value": "[reference('storageAccount').primaryEndpoints.queue]"
                            },
                            "storageAccountTableEndpoint": {
                              "type": "string",
                              "value": "[reference('storageAccount').primaryEndpoints.table]"
                            }
                          }
                        }
                      }
                    },
                    "containerRegistryDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('containerRegistryDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "containerRegistryName": {
                            "value": "[variables('containerRegistryName')]"
                          },
                          "containerRegistryLocation": {
                            "value": "[parameters('resourceLocation')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "15957379082092363947"
                            },
                            "description": "This template deploys Azure Container Registry with enterprise-grade security and governance features.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "containerRegistryName": {
                              "type": "string",
                              "minLength": 5,
                              "maxLength": 50,
                              "metadata": {
                                "description": "The name of the Azure Container Registry."
                              }
                            },
                            "containerRegistryLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "The location for the Azure Container Registry resource."
                              }
                            }
                          },
                          "resources": {
                            "containerRegistry": {
                              "type": "Microsoft.ContainerRegistry/registries",
                              "apiVersion": "2025-04-01",
                              "name": "[parameters('containerRegistryName')]",
                              "location": "[parameters('containerRegistryLocation')]",
                              "sku": {
                                "name": "Basic"
                              },
                              "properties": {
                                "adminUserEnabled": true,
                                "policies": {
                                  "quarantinePolicy": {
                                    "status": "Disabled"
                                  },
                                  "trustPolicy": {
                                    "status": "Disabled"
                                  },
                                  "retentionPolicy": {
                                    "status": "Disabled"
                                  },
                                  "exportPolicy": {
                                    "status": "Enabled"
                                  },
                                  "azureADAuthenticationAsArmPolicy": {
                                    "status": "Enabled"
                                  }
                                },
                                "encryption": {
                                  "status": "Disabled"
                                },
                                "dataEndpointEnabled": false,
                                "publicNetworkAccess": "Enabled",
                                "networkRuleBypassOptions": "AzureServices",
                                "zoneRedundancy": "Disabled",
                                "anonymousPullEnabled": false
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deploymentType": "Bicep",
                                "resourceType": "Container Registry"
                              }
                            }
                          },
                          "outputs": {
                            "containerRegistryName": {
                              "type": "string",
                              "value": "[parameters('containerRegistryName')]"
                            },
                            "containerRegistryId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.ContainerRegistry/registries', parameters('containerRegistryName'))]"
                            },
                            "containerRegistryLoginServer": {
                              "type": "string",
                              "value": "[reference('containerRegistry').loginServer]"
                            },
                            "containerRegistryResourceId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.ContainerRegistry/registries', parameters('containerRegistryName'))]"
                            }
                          }
                        }
                      }
                    },
                    "sqlServerDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('sqlServerDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "sqlServerName": {
                            "value": "[variables('sqlServerName')]"
                          },
                          "sqlServerLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "resourceDeploymentDate": {
                            "value": "[parameters('resourceDeploymentDate')]"
                          },
                          "sqlServerAdministratorPassword": {
                            "value": "TempP@ssw0rd123!"
                          },
                          "sqlServerAdministratorUserName": {
                            "value": "sqladmin"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "3347403411695393068"
                            },
                            "description": "This template will create a new Azure SQL server resource with standardized metadata.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "sqlServerName": {
                              "type": "string",
                              "minLength": 1,
                              "maxLength": 63,
                              "metadata": {
                                "description": "The SQL Server name."
                              }
                            },
                            "sqlServerLocation": {
                              "type": "string",
                              "allowedValues": [
                                "swedencentral",
                                "norwayeast",
                                "westeurope",
                                "northeurope"
                              ],
                              "metadata": {
                                "description": "The location for the SQL Server resource."
                              }
                            },
                            "sqlServerAdministratorUserName": {
                              "type": "securestring",
                              "metadata": {
                                "description": "The username for the local SQL Server administrator."
                              }
                            },
                            "sqlServerAdministratorPassword": {
                              "type": "securestring",
                              "metadata": {
                                "description": "The password for the local SQL Server administrator."
                              }
                            },
                            "resourceDeploymentDate": {
                              "type": "string",
                              "metadata": {
                                "description": "The date when the deployment is executed."
                              }
                            }
                          },
                          "variables": {
                            "commonTags": {
                              "environment": "PRODUCTION",
                              "deploymentType": "Bicep",
                              "deploymentDate": "[parameters('resourceDeploymentDate')]",
                              "deploymentAuthor": "Alexandru-Razvan Olariu",
                              "module": "storage-sql",
                              "costCenter": "infrastructure",
                              "owner": "Alexandru-Razvan Olariu",
                              "project": "arolariu.ro",
                              "version": "2.0.0",
                              "criticality": "high",
                              "dataClassification": "internal",
                              "backup": "required",
                              "resourceType": "SQL Server"
                            }
                          },
                          "resources": {
                            "sqlServer::sqlServerAdvancedThreatProtection": {
                              "type": "Microsoft.Sql/servers/advancedThreatProtectionSettings",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), 'Default')]",
                              "properties": {
                                "state": "Disabled"
                              },
                              "dependsOn": [
                                "sqlServer"
                              ]
                            },
                            "sqlServer::sqlServerAuditPolicy": {
                              "type": "Microsoft.Sql/servers/auditingPolicies",
                              "apiVersion": "2014-04-01",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), 'Default')]",
                              "properties": {
                                "auditingState": "Disabled"
                              },
                              "dependsOn": [
                                "sqlServer"
                              ]
                            },
                            "sqlServer::sqlServerAuditSettings": {
                              "type": "Microsoft.Sql/servers/auditingSettings",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), 'default')]",
                              "properties": {
                                "state": "Disabled"
                              },
                              "dependsOn": [
                                "sqlServer"
                              ]
                            },
                            "sqlServer::sqlServerConnectionPolicies": {
                              "type": "Microsoft.Sql/servers/connectionPolicies",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), 'Default')]",
                              "properties": {
                                "connectionType": "Default"
                              },
                              "dependsOn": [
                                "sqlServer"
                              ]
                            },
                            "sqlServer::sqlServerAzureAdOnlyAuth": {
                              "type": "Microsoft.Sql/servers/azureADOnlyAuthentications",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), 'Default')]",
                              "properties": {
                                "azureADOnlyAuthentication": false
                              },
                              "dependsOn": [
                                "sqlServer"
                              ]
                            },
                            "sqlServer": {
                              "type": "Microsoft.Sql/servers",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[parameters('sqlServerName')]",
                              "location": "[parameters('sqlServerLocation')]",
                              "properties": {
                                "minimalTlsVersion": "1.2",
                                "publicNetworkAccess": "Enabled",
                                "version": "12.0",
                                "administratorLogin": "[parameters('sqlServerAdministratorUserName')]",
                                "administratorLoginPassword": "[parameters('sqlServerAdministratorPassword')]",
                                "administrators": {
                                  "administratorType": "ActiveDirectory",
                                  "login": "admin@arolariu.ro",
                                  "sid": "ee9acc3d-8a79-489d-b4bf-aaae428b29db",
                                  "tenantId": "[subscription().tenantId]"
                                }
                              },
                              "tags": "[variables('commonTags')]"
                            }
                          },
                          "outputs": {
                            "sqlServerName": {
                              "type": "string",
                              "value": "[parameters('sqlServerName')]"
                            },
                            "sqlServerResourceId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Sql/servers', parameters('sqlServerName'))]"
                            },
                            "sqlServerFqdn": {
                              "type": "string",
                              "value": "[reference('sqlServer').fullyQualifiedDomainName]"
                            }
                          }
                        }
                      }
                    },
                    "sqlServerDatabaseDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('sqlServerDatabaseDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "sqlServerName": {
                            "value": "[reference('sqlServerDeployment').outputs.sqlServerName.value]"
                          },
                          "sqlDatabaseNamePrefix": {
                            "value": "[format('{0}-sqlserver-db', parameters('resourceConventionPrefix'))]"
                          },
                          "sqlDatabaseLocation": {
                            "value": "[parameters('resourceLocation')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "7318651117096934396"
                            },
                            "description": "This template will deploy a primary, DTU-based SQL database, and a secondary, serverless SQL database. The primary database will be created with a Standard SKU, while the secondary database will be created with a GeneralPurpose SKU. The secondary database will be created as a free database, and will be automatically paused after an hour of inactivity. The databases will be created in the same location as the resource group.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "sqlServerName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the SQL Server."
                              }
                            },
                            "sqlDatabaseNamePrefix": {
                              "type": "string",
                              "metadata": {
                                "description": "The prefix for the SQL Database names."
                              }
                            },
                            "sqlDatabaseLocation": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]",
                              "metadata": {
                                "description": "The location for the SQL Database resources."
                              }
                            }
                          },
                          "variables": {
                            "sqlDatabasePrimaryName": "[format('{0}-primary', parameters('sqlDatabaseNamePrefix'))]",
                            "sqlDatabaseSecondaryName": "[format('{0}-secondary', parameters('sqlDatabaseNamePrefix'))]"
                          },
                          "resources": {
                            "sqlServer": {
                              "existing": true,
                              "type": "Microsoft.Sql/servers",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[parameters('sqlServerName')]"
                            },
                            "sqlDatabasePrimary": {
                              "type": "Microsoft.Sql/servers/databases",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), variables('sqlDatabasePrimaryName'))]",
                              "location": "[parameters('sqlDatabaseLocation')]",
                              "sku": {
                                "name": "Standard",
                                "tier": "Standard",
                                "capacity": 10
                              },
                              "properties": {
                                "catalogCollation": "SQL_Latin1_General_CP1_CI_AS",
                                "collation": "SQL_Latin1_General_CP1_CI_AS",
                                "maxSizeBytes": 268435456000,
                                "zoneRedundant": false,
                                "readScale": "Disabled",
                                "requestedBackupStorageRedundancy": "Local",
                                "isLedgerOn": false,
                                "availabilityZone": "NoPreference"
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            },
                            "sqlDatabaseSecondary": {
                              "type": "Microsoft.Sql/servers/databases",
                              "apiVersion": "2024-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('sqlServerName'), variables('sqlDatabaseSecondaryName'))]",
                              "location": "[parameters('sqlDatabaseLocation')]",
                              "sku": {
                                "name": "GP_S_Gen5_2",
                                "tier": "GeneralPurpose"
                              },
                              "identity": {
                                "type": "None",
                                "userAssignedIdentities": {}
                              },
                              "properties": {
                                "catalogCollation": "SQL_Latin1_General_CP1_CI_AS",
                                "collation": "SQL_Latin1_General_CP1_CI_AS",
                                "maxSizeBytes": 2147483648,
                                "zoneRedundant": false,
                                "readScale": "Disabled",
                                "requestedBackupStorageRedundancy": "Local",
                                "isLedgerOn": false,
                                "availabilityZone": "NoPreference",
                                "autoPauseDelay": 60,
                                "useFreeLimit": true,
                                "freeLimitExhaustionBehavior": "AutoPause"
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "sqlServerDeployment"
                      ]
                    },
                    "noSqlServerDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('noSqlServerDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "noSqlServerName": {
                            "value": "[variables('noSqlServerName')]"
                          },
                          "noSqlServerLocation": {
                            "value": "[parameters('resourceLocation')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "8513039748533519112"
                            },
                            "description": "This template will create a new Azure NoSQL server resource.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "noSqlServerName": {
                              "type": "string",
                              "metadata": {
                                "description": "The NoSQL Server name."
                              }
                            },
                            "noSqlServerLocation": {
                              "type": "string",
                              "metadata": {
                                "description": "The location for the NoSQL Server resource."
                              }
                            }
                          },
                          "resources": {
                            "noSqlServer": {
                              "type": "Microsoft.DocumentDB/databaseAccounts",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[parameters('noSqlServerName')]",
                              "location": "[parameters('noSqlServerLocation')]",
                              "properties": {
                                "publicNetworkAccess": "Enabled",
                                "enableAutomaticFailover": false,
                                "enableMultipleWriteLocations": false,
                                "isVirtualNetworkFilterEnabled": false,
                                "disableKeyBasedMetadataWriteAccess": false,
                                "enableFreeTier": true,
                                "enableAnalyticalStorage": false,
                                "analyticalStorageConfiguration": {
                                  "schemaType": "WellDefined"
                                },
                                "createMode": "Default",
                                "databaseAccountOfferType": "Standard",
                                "defaultIdentity": "FirstPartyIdentity",
                                "networkAclBypass": "None",
                                "disableLocalAuth": false,
                                "enablePartitionMerge": false,
                                "enableBurstCapacity": false,
                                "minimalTlsVersion": "Tls12",
                                "consistencyPolicy": {
                                  "defaultConsistencyLevel": "Session",
                                  "maxIntervalInSeconds": 5,
                                  "maxStalenessPrefix": 100
                                },
                                "locations": [
                                  {
                                    "locationName": "[parameters('noSqlServerLocation')]",
                                    "failoverPriority": 0,
                                    "isZoneRedundant": false
                                  }
                                ],
                                "backupPolicy": {
                                  "type": "Continuous",
                                  "continuousModeProperties": {
                                    "tier": "Continuous7Days"
                                  }
                                },
                                "capacity": {
                                  "totalThroughputLimit": 1000
                                }
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          },
                          "outputs": {
                            "noSqlServerName": {
                              "type": "string",
                              "value": "[parameters('noSqlServerName')]"
                            }
                          }
                        }
                      }
                    },
                    "noSqlServerDatabaseDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('noSqlServerDatabaseDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "noSqlServerLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "noSqlServerName": {
                            "value": "[reference('noSqlServerDeployment').outputs.noSqlServerName.value]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "16334234556775031338"
                            },
                            "description": "This template will deploy the NoSQL server database resources.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "noSqlServerName": {
                              "type": "string",
                              "metadata": {
                                "description": "The name of the NoSQL server."
                              }
                            },
                            "noSqlServerLocation": {
                              "type": "string",
                              "metadata": {
                                "description": "The location for the NoSQL server resource."
                              }
                            }
                          },
                          "resources": {
                            "noSqlServer": {
                              "existing": true,
                              "type": "Microsoft.DocumentDB/databaseAccounts",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[parameters('noSqlServerName')]"
                            },
                            "primaryNoSqlDatabase": {
                              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[format('{0}/{1}', parameters('noSqlServerName'), 'primary')]",
                              "location": "[parameters('noSqlServerLocation')]",
                              "properties": {
                                "resource": {
                                  "id": "primary"
                                }
                              }
                            },
                            "primaryNoSqlDatabaseSettings": {
                              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/throughputSettings",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[format('{0}/{1}/{2}', parameters('noSqlServerName'), 'primary', 'default')]",
                              "properties": {
                                "resource": {
                                  "throughput": 100,
                                  "autoscaleSettings": {
                                    "maxThroughput": 1000
                                  }
                                }
                              },
                              "dependsOn": [
                                "primaryNoSqlDatabase"
                              ]
                            },
                            "primaryNoSqlDatabaseInvoiceContainer": {
                              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[format('{0}/{1}/{2}', parameters('noSqlServerName'), 'primary', 'invoices')]",
                              "properties": {
                                "resource": {
                                  "id": "invoices",
                                  "indexingPolicy": {
                                    "indexingMode": "consistent",
                                    "automatic": true,
                                    "includedPaths": [
                                      {
                                        "path": "/*"
                                      }
                                    ],
                                    "excludedPaths": [
                                      {
                                        "path": "/_etag/?"
                                      }
                                    ]
                                  },
                                  "partitionKey": {
                                    "paths": [
                                      "/UserIdentifier"
                                    ],
                                    "kind": "Hash",
                                    "version": 2
                                  },
                                  "uniqueKeyPolicy": {
                                    "uniqueKeys": []
                                  },
                                  "conflictResolutionPolicy": {
                                    "mode": "LastWriterWins",
                                    "conflictResolutionPath": "_ts"
                                  }
                                }
                              },
                              "dependsOn": [
                                "primaryNoSqlDatabase"
                              ]
                            },
                            "primaryNoSqlDatabaseMerchantContainer": {
                              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
                              "apiVersion": "2025-05-01-preview",
                              "name": "[format('{0}/{1}/{2}', parameters('noSqlServerName'), 'primary', 'merchants')]",
                              "properties": {
                                "resource": {
                                  "id": "merchants",
                                  "indexingPolicy": {
                                    "indexingMode": "consistent",
                                    "automatic": true,
                                    "includedPaths": [
                                      {
                                        "path": "/*"
                                      }
                                    ],
                                    "excludedPaths": [
                                      {
                                        "path": "/_etag/?"
                                      }
                                    ]
                                  },
                                  "partitionKey": {
                                    "paths": [
                                      "/ParentCompanyId"
                                    ],
                                    "kind": "Hash",
                                    "version": 2
                                  },
                                  "uniqueKeyPolicy": {
                                    "uniqueKeys": []
                                  },
                                  "conflictResolutionPolicy": {
                                    "mode": "LastWriterWins",
                                    "conflictResolutionPath": "_ts"
                                  }
                                }
                              },
                              "dependsOn": [
                                "primaryNoSqlDatabase"
                              ]
                            }
                          }
                        }
                      },
                      "dependsOn": [
                        "noSqlServerDeployment"
                      ]
                    }
                  },
                  "outputs": {
                    "storageAccountName": {
                      "type": "string",
                      "value": "[reference('storageAccountDeployment').outputs.storageAccountName.value]"
                    },
                    "storageAccountId": {
                      "type": "string",
                      "value": "[reference('storageAccountDeployment').outputs.storageAccountId.value]"
                    },
                    "storageAccountBlobEndpoint": {
                      "type": "string",
                      "value": "[reference('storageAccountDeployment').outputs.storageAccountBlobEndpoint.value]"
                    },
                    "sqlServerName": {
                      "type": "string",
                      "value": "[reference('sqlServerDeployment').outputs.sqlServerName.value]"
                    },
                    "cosmosAccountName": {
                      "type": "string",
                      "value": "[reference('noSqlServerDeployment').outputs.noSqlServerName.value]"
                    }
                  }
                }
              },
              "dependsOn": [
                "identitiesDeployment"
              ]
            },
            "computeDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('computeDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "resourceConventionPrefix": {
                    "value": "[variables('resourceConventionPrefix')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "2100526197141824565"
                    }
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceConventionPrefix": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 20,
                      "metadata": {
                        "description": "The prefix to use for the names of the resources."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the app service plans."
                      }
                    }
                  },
                  "resources": {
                    "appServicePlansDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('appServicePlansDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "appServicePlanLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "appServicePlanDeploymentDate": {
                            "value": "[parameters('resourceDeploymentDate')]"
                          },
                          "appServicePlanConventionPrefix": {
                            "value": "[parameters('resourceConventionPrefix')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "8280563273114392261"
                            },
                            "description": "This template deploys two App Service Farms, in the same region, for production and development environments.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "appServicePlanLocation": {
                              "type": "string",
                              "allowedValues": [
                                "swedencentral",
                                "norwayeast",
                                "westeurope",
                                "northeurope"
                              ],
                              "metadata": {
                                "description": "The location for the app service plans."
                              }
                            },
                            "appServicePlanConventionPrefix": {
                              "type": "string",
                              "minLength": 1,
                              "maxLength": 20,
                              "metadata": {
                                "description": "The prefix for the app service plans."
                              }
                            },
                            "appServicePlanDeploymentDate": {
                              "type": "string",
                              "metadata": {
                                "description": "The date when the deployment is executed."
                              }
                            }
                          },
                          "variables": {
                            "commonTags": {
                              "environment": "PRODUCTION",
                              "deploymentType": "Bicep",
                              "deploymentDate": "[parameters('appServicePlanDeploymentDate')]",
                              "deploymentAuthor": "Alexandru-Razvan Olariu",
                              "module": "compute",
                              "costCenter": "infrastructure",
                              "owner": "Alexandru-Razvan Olariu",
                              "project": "arolariu.ro",
                              "version": "2.0.0",
                              "criticality": "high",
                              "dataClassification": "internal",
                              "backup": "required",
                              "resourceType": "App Service Plan"
                            },
                            "appPlans": [
                              {
                                "name": "[format('{0}-production', parameters('appServicePlanConventionPrefix'))]",
                                "location": "[parameters('appServicePlanLocation')]",
                                "perSiteScaling": true,
                                "sku": {
                                  "name": "B2",
                                  "tier": "Basic"
                                }
                              },
                              {
                                "name": "[format('{0}-development', parameters('appServicePlanConventionPrefix'))]",
                                "location": "[parameters('appServicePlanLocation')]",
                                "perSiteScaling": false,
                                "sku": {
                                  "name": "B1",
                                  "tier": "Basic"
                                }
                              }
                            ]
                          },
                          "resources": {
                            "appPlanFarm": {
                              "copy": {
                                "name": "appPlanFarm",
                                "count": "[length(variables('appPlans'))]"
                              },
                              "type": "Microsoft.Web/serverfarms",
                              "apiVersion": "2024-11-01",
                              "name": "[variables('appPlans')[copyIndex()].name]",
                              "location": "[variables('appPlans')[copyIndex()].location]",
                              "sku": {
                                "name": "[variables('appPlans')[copyIndex()].sku.name]",
                                "tier": "[variables('appPlans')[copyIndex()].sku.tier]"
                              },
                              "kind": "linux",
                              "properties": {
                                "reserved": true,
                                "zoneRedundant": false,
                                "perSiteScaling": "[variables('appPlans')[copyIndex()].perSiteScaling]"
                              },
                              "tags": "[union(variables('commonTags'), createObject('tier', if(equals(variables('appPlans')[copyIndex()].name, format('{0}-production', parameters('appServicePlanConventionPrefix'))), 'production', 'development'), 'sku', variables('appPlans')[copyIndex()].sku.name, 'skuTier', variables('appPlans')[copyIndex()].sku.tier))]"
                            }
                          },
                          "outputs": {
                            "productionAppPlanId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Web/serverfarms', variables('appPlans')[0].name)]"
                            },
                            "developmentAppPlanId": {
                              "type": "string",
                              "value": "[resourceId('Microsoft.Web/serverfarms', variables('appPlans')[1].name)]"
                            }
                          }
                        }
                      }
                    }
                  },
                  "outputs": {
                    "productionAppPlanId": {
                      "type": "string",
                      "value": "[reference('appServicePlansDeployment').outputs.productionAppPlanId.value]"
                    },
                    "developmentAppPlanId": {
                      "type": "string",
                      "value": "[reference('appServicePlansDeployment').outputs.developmentAppPlanId.value]"
                    }
                  }
                }
              },
              "dependsOn": [
                "identitiesDeployment"
              ]
            },
            "websiteDeployment": {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "[format('websiteDeployment-{0}', parameters('resourceDeploymentDate'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "resourceLocation": {
                    "value": "[parameters('resourceLocation')]"
                  },
                  "resourceDeploymentDate": {
                    "value": "[parameters('resourceDeploymentDate')]"
                  },
                  "productionAppPlanId": {
                    "value": "[reference('computeDeployment').outputs.productionAppPlanId.value]"
                  },
                  "developmentAppPlanId": {
                    "value": "[reference('computeDeployment').outputs.developmentAppPlanId.value]"
                  },
                  "managedIdentityFrontendId": {
                    "value": "[reference('identitiesDeployment').outputs.managedIdentitiesList.value[0].id]"
                  },
                  "managedIdentityBackendId": {
                    "value": "[reference('identitiesDeployment').outputs.managedIdentitiesList.value[1].id]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "languageVersion": "2.0",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.36.1.42791",
                      "templateHash": "679746977303323660"
                    }
                  },
                  "parameters": {
                    "resourceDeploymentDate": {
                      "type": "string",
                      "defaultValue": "[utcNow()]",
                      "metadata": {
                        "description": "The date when the deployment is executed."
                      }
                    },
                    "resourceLocation": {
                      "type": "string",
                      "allowedValues": [
                        "swedencentral",
                        "norwayeast",
                        "westeurope",
                        "northeurope"
                      ],
                      "metadata": {
                        "description": "The location for the resources."
                      }
                    },
                    "productionAppPlanId": {
                      "type": "string",
                      "metadata": {
                        "description": "The ID of the production app service plan."
                      }
                    },
                    "developmentAppPlanId": {
                      "type": "string",
                      "metadata": {
                        "description": "The ID of the development app service plan."
                      }
                    },
                    "managedIdentityBackendId": {
                      "type": "string"
                    },
                    "managedIdentityFrontendId": {
                      "type": "string"
                    }
                  },
                  "resources": {
                    "apiWebsiteDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('apiWebsiteDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "apiWebsiteLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "apiWebsiteIdentityId": {
                            "value": "[parameters('managedIdentityBackendId')]"
                          },
                          "apiWebsitePlanId": {
                            "value": "[parameters('productionAppPlanId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "352114670436146448"
                            },
                            "description": "This template will create the api.arolariu.ro app service site.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "apiWebsiteLocation": {
                              "type": "string"
                            },
                            "apiWebsitePlanId": {
                              "type": "string"
                            },
                            "apiWebsiteIdentityId": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "apiWebsite": {
                              "type": "Microsoft.Web/sites",
                              "apiVersion": "2024-11-01",
                              "name": "api-arolariu-ro",
                              "location": "[parameters('apiWebsiteLocation')]",
                              "kind": "app,linux",
                              "identity": {
                                "type": "UserAssigned",
                                "userAssignedIdentities": {
                                  "[format('{0}', parameters('apiWebsiteIdentityId'))]": {}
                                }
                              },
                              "properties": {
                                "enabled": true,
                                "serverFarmId": "[parameters('apiWebsitePlanId')]",
                                "reserved": true,
                                "isXenon": false,
                                "hyperV": false,
                                "siteConfig": {
                                  "alwaysOn": true,
                                  "numberOfWorkers": 1,
                                  "http20Enabled": true,
                                  "functionAppScaleLimit": 0,
                                  "minimumElasticInstanceCount": 0,
                                  "linuxFxVersion": "DOTNETCORE|8.0",
                                  "requestTracingEnabled": true,
                                  "remoteDebuggingEnabled": false,
                                  "httpLoggingEnabled": true,
                                  "logsDirectorySizeLimit": 35,
                                  "detailedErrorLoggingEnabled": false,
                                  "use32BitWorkerProcess": false,
                                  "webSocketsEnabled": true,
                                  "loadBalancing": "LeastRequests",
                                  "preWarmedInstanceCount": 0,
                                  "ftpsState": "Disabled"
                                },
                                "scmSiteAlsoStopped": false,
                                "clientAffinityEnabled": false,
                                "clientCertEnabled": false,
                                "clientCertMode": "Required",
                                "hostNamesDisabled": false,
                                "containerSize": 0,
                                "dailyMemoryTimeQuota": 0,
                                "httpsOnly": true,
                                "redundancyMode": "None",
                                "publicNetworkAccess": "Enabled",
                                "storageAccountRequired": false,
                                "keyVaultReferenceIdentity": "[parameters('apiWebsiteIdentityId')]"
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          }
                        }
                      }
                    },
                    "mainWebsiteDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('mainWebsiteDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "mainWebsiteLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "productionAppPlanId": {
                            "value": "[parameters('productionAppPlanId')]"
                          },
                          "mainWebsiteIdentityId": {
                            "value": "[parameters('managedIdentityFrontendId')]"
                          },
                          "resourceDeploymentDate": {
                            "value": "[parameters('resourceDeploymentDate')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "12982921681903707669"
                            },
                            "description": "This template will create the arolariu.ro app service site.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "mainWebsiteLocation": {
                              "type": "string"
                            },
                            "productionAppPlanId": {
                              "type": "string"
                            },
                            "mainWebsiteIdentityId": {
                              "type": "string"
                            },
                            "resourceDeploymentDate": {
                              "type": "string",
                              "metadata": {
                                "description": "The date when the deployment is executed."
                              }
                            }
                          },
                          "variables": {
                            "commonTags": {
                              "environment": "PRODUCTION",
                              "deploymentType": "Bicep",
                              "deploymentDate": "[parameters('resourceDeploymentDate')]",
                              "deploymentAuthor": "Alexandru-Razvan Olariu",
                              "module": "sites-main",
                              "costCenter": "infrastructure",
                              "owner": "Alexandru-Razvan Olariu",
                              "project": "arolariu.ro",
                              "version": "2.0.0",
                              "criticality": "high",
                              "dataClassification": "public",
                              "backup": "required",
                              "resourceType": "Web App",
                              "websiteType": "main-website"
                            }
                          },
                          "resources": {
                            "mainWebsite": {
                              "type": "Microsoft.Web/sites",
                              "apiVersion": "2024-11-01",
                              "name": "www-arolariu-ro",
                              "location": "[parameters('mainWebsiteLocation')]",
                              "kind": "app,linux,container",
                              "identity": {
                                "type": "UserAssigned",
                                "userAssignedIdentities": {
                                  "[format('{0}', parameters('mainWebsiteIdentityId'))]": {}
                                }
                              },
                              "properties": {
                                "clientAffinityEnabled": true,
                                "clientCertEnabled": false,
                                "reserved": true,
                                "isXenon": false,
                                "hyperV": false,
                                "hostNamesDisabled": false,
                                "containerSize": 0,
                                "httpsOnly": true,
                                "redundancyMode": "None",
                                "publicNetworkAccess": "Enabled",
                                "storageAccountRequired": false,
                                "enabled": true,
                                "serverFarmId": "[parameters('productionAppPlanId')]",
                                "siteConfig": {
                                  "acrUseManagedIdentityCreds": false,
                                  "publishingUsername": "$arolariu",
                                  "autoHealEnabled": false,
                                  "numberOfWorkers": 1,
                                  "functionAppScaleLimit": 0,
                                  "minimumElasticInstanceCount": 1,
                                  "alwaysOn": true,
                                  "cors": {
                                    "allowedOrigins": [
                                      "https://clerk.arolariu.ro",
                                      "https://api.arolariu.ro",
                                      "https://cdn.arolariu.ro"
                                    ]
                                  },
                                  "localMySqlEnabled": false,
                                  "ftpsState": "Disabled",
                                  "healthCheckPath": "/",
                                  "http20Enabled": true,
                                  "httpLoggingEnabled": true,
                                  "logsDirectorySizeLimit": 50,
                                  "detailedErrorLoggingEnabled": false,
                                  "scmType": "GithubAction",
                                  "scmIpSecurityRestrictionsDefaultAction": "Allow",
                                  "scmIpSecurityRestrictionsUseMain": false,
                                  "use32BitWorkerProcess": false,
                                  "loadBalancing": "LeastRequests",
                                  "ipSecurityRestrictions": [
                                    {
                                      "ipAddress": "AzureFrontDoor.Backend",
                                      "tag": "ServiceTag",
                                      "name": "AzureFrontDoor",
                                      "action": "Allow",
                                      "priority": 100
                                    },
                                    {
                                      "ipAddress": "Any",
                                      "tag": "Default",
                                      "name": "Default",
                                      "action": "Deny",
                                      "priority": 2147483647
                                    }
                                  ],
                                  "ipSecurityRestrictionsDefaultAction": "Deny",
                                  "minTlsVersion": "1.3",
                                  "nodeVersion": "22",
                                  "webSocketsEnabled": true
                                }
                              },
                              "tags": "[variables('commonTags')]"
                            }
                          },
                          "outputs": {
                            "mainWebsiteUrl": {
                              "type": "string",
                              "value": "[reference('mainWebsite').defaultHostName]"
                            }
                          }
                        }
                      }
                    },
                    "devWebsiteDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('devWebsiteDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "devWebsiteLocation": {
                            "value": "[parameters('resourceLocation')]"
                          },
                          "developmentAppPlanId": {
                            "value": "[parameters('developmentAppPlanId')]"
                          },
                          "devWebsiteIdentityId": {
                            "value": "[parameters('managedIdentityFrontendId')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "1458122774965435717"
                            },
                            "description": "This template will create the dev.arolariu.ro app service site.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "devWebsiteLocation": {
                              "type": "string"
                            },
                            "developmentAppPlanId": {
                              "type": "string"
                            },
                            "devWebsiteIdentityId": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "devWebsite": {
                              "type": "Microsoft.Web/sites",
                              "apiVersion": "2024-11-01",
                              "name": "dev-arolariu-ro",
                              "location": "[parameters('devWebsiteLocation')]",
                              "kind": "app,linux,container",
                              "identity": {
                                "type": "UserAssigned",
                                "userAssignedIdentities": {
                                  "[format('{0}', parameters('devWebsiteIdentityId'))]": {}
                                }
                              },
                              "properties": {
                                "clientAffinityEnabled": true,
                                "clientCertEnabled": false,
                                "reserved": true,
                                "isXenon": false,
                                "hyperV": false,
                                "hostNamesDisabled": false,
                                "containerSize": 0,
                                "httpsOnly": true,
                                "redundancyMode": "None",
                                "publicNetworkAccess": "Enabled",
                                "storageAccountRequired": false,
                                "enabled": true,
                                "serverFarmId": "[parameters('developmentAppPlanId')]",
                                "siteConfig": {
                                  "acrUseManagedIdentityCreds": false,
                                  "publishingUsername": "$dev-arolariu",
                                  "autoHealEnabled": false,
                                  "numberOfWorkers": 1,
                                  "functionAppScaleLimit": 0,
                                  "minimumElasticInstanceCount": 0,
                                  "alwaysOn": true,
                                  "cors": {
                                    "allowedOrigins": [
                                      "https://clerk.arolariu.ro",
                                      "https://api.arolariu.ro",
                                      "https://cdn.arolariu.ro"
                                    ]
                                  },
                                  "localMySqlEnabled": false,
                                  "ftpsState": "Disabled",
                                  "healthCheckPath": "/",
                                  "http20Enabled": true,
                                  "httpLoggingEnabled": true,
                                  "logsDirectorySizeLimit": 50,
                                  "detailedErrorLoggingEnabled": false,
                                  "scmType": "GithubAction",
                                  "scmIpSecurityRestrictionsDefaultAction": "Allow",
                                  "scmIpSecurityRestrictionsUseMain": false,
                                  "use32BitWorkerProcess": false,
                                  "loadBalancing": "LeastRequests",
                                  "ipSecurityRestrictions": [
                                    {
                                      "ipAddress": "Any",
                                      "tag": "Default",
                                      "name": "Default",
                                      "action": "Allow",
                                      "priority": 2147483647
                                    }
                                  ],
                                  "ipSecurityRestrictionsDefaultAction": "Allow",
                                  "minTlsVersion": "1.1",
                                  "nodeVersion": "22",
                                  "webSocketsEnabled": true
                                }
                              },
                              "tags": {
                                "environment": "DEVELOPMENT",
                                "deployment": "Bicep"
                              }
                            }
                          },
                          "outputs": {
                            "devWebsiteUrl": {
                              "type": "string",
                              "value": "[reference('devWebsite').defaultHostName]"
                            }
                          }
                        }
                      }
                    },
                    "docsWebsiteDeployment": {
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2022-09-01",
                      "name": "[format('docsWebsiteDeployment-{0}', parameters('resourceDeploymentDate'))]",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "staticWebAppLocation": {
                            "value": "[parameters('resourceLocation')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "languageVersion": "2.0",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.36.1.42791",
                              "templateHash": "6467703119403351460"
                            },
                            "description": "This template will create the docs.arolariu.ro static web app site.",
                            "author": "Alexandru-Razvan Olariu"
                          },
                          "parameters": {
                            "staticWebAppLocation": {
                              "type": "string"
                            }
                          },
                          "resources": {
                            "docsStaticWebApp": {
                              "type": "Microsoft.Web/staticSites",
                              "apiVersion": "2024-11-01",
                              "name": "docs-arolariu-ro",
                              "location": "[parameters('staticWebAppLocation')]",
                              "sku": {
                                "name": "Free",
                                "tier": "Free"
                              },
                              "properties": {
                                "repositoryUrl": "https://github.com/arolariu/arolariu.ro",
                                "branch": "main",
                                "stagingEnvironmentPolicy": "Disabled",
                                "allowConfigFileUpdates": true,
                                "provider": "GitHub",
                                "enterpriseGradeCdnStatus": "Disabled"
                              },
                              "tags": {
                                "environment": "PRODUCTION",
                                "deployment": "Bicep"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "dependsOn": [
                "computeDeployment",
                "configurationDeployment",
                "identitiesDeployment",
                "observabilityDeployment",
                "storageDeployment"
              ]
            }
          }
        }
      },
      "dependsOn": [
        "resourceGroup"
      ]
    }
  }
}